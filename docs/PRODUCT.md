# 产品文档：R2RML TBox->ABox 映射系统（Demo）

## 目标
- 将业务数据（CSV/XLSX 或 JDBC）通过语义匹配映射到已存在的 TBox 数据属性，生成 ABox 实例或生成映射关系用于后续物化。
- 形成可演示的最小闭环 Demo：上传本体 + 数据源 -> 自动匹配 -> 人工调整 -> 生成 ABox 或映射 -> 可接入本地 Ontop 测试。

## 背景与范围
- 该系统为整体工程的第 2 步：业务数据 -> RDF 实例（ABox）。
- 输入：TBox（RDF/OWL）+ 业务数据表结构（CSV/XLSX 表头或 JDBC 表元数据）。
- 输出：
  - ABox（RDF/Turtle 或 RDF/XML）
  - 或 R2RML 映射（用于 Ontop 物化）

## 角色与使用场景
- 知识工程师：上传本体并定义语义映射。
- 数据工程师：提供业务数据源（文件或 JDBC）。
- 业务用户：检查和调整匹配结果。

## 核心流程（端到端）
1. 上传 TBox（RDF/OWL），可选择仅显示叶子属性，并按类分组展示；支持 Graph 可视化与 TTL 展示（可缩放/平移/居中，边显示 object property 名称，节点悬停展示 data property）。
2. 选择数据源类型：
   - CSV/XLSX：支持多文件或目录上传，解析表头字段 + 可选样例数据；
   - JDBC：连接测试 -> 获取元数据 -> 选择表 -> 获取字段。
3. 智能体语义匹配：先理解表结构及字段关系，先进行“类名-表名”匹配，再进行“属性-字段”匹配；以 TBox 数据属性为锚点，按类分组显示；选择表后再选择字段；支持置信度阈值过滤。
4. 展示匹配结果（含置信度/说明）；支持人工修改。
5. 选择输出方式：
   - 物化生成 ABox RDF；
   - 仅保留映射关系，供 Ontop 进行后续物化。
6. 下载或保存输出文件。

## 主要功能清单（MVP）
- TBox 上传与解析（RDF/OWL）。
- CSV/XLSX 表头解析（含少量样例数据）。
- JDBC 连接测试与元数据获取。
- 智能体字段-属性匹配（含结果解释与置信度阈值）。
- 匹配结果可视化与人工调整。
- 输出 ABox RDF 或 R2RML 映射。
- 本地 Ontop 服务集成（Demo 级）。

## 智能体与模型配置
- 智能体框架：OpenAI Agents 框架。
- Skill：R2RML（执行从 TBox 到 ABox 的映射逻辑）。
- 模型：Qwen-plus（兼容模式 API）。
- Embedding/Rerank：text-embedding-v4 / qwen3-rerank。
- 配置建议：API key 使用环境变量注入，不写入仓库。

## 关键数据与产物
- TBox：RDF/OWL 文件。
- 业务数据结构：
  - CSV/XLSX 表头 + 可选样例数据；
  - JDBC 表结构与字段。
- 匹配结果：字段 -> 数据属性 的映射表。
- 产物：
  - ABox RDF 文件；
  - 或 R2RML 映射文件。

## 交互与界面（页面草图级）
- 页面 1：上传 TBox。
- 页面 2：选择数据源类型并上传/连接。
- 页面 3：字段与数据属性的匹配结果 + 手动调整。
- 页面 4：选择输出方式与结果下载。

## 非功能需求
- 易用性：流程清晰，可视化匹配结果。
- 可扩展：后续可支持更多数据源与推理校验。
- 可追溯：保留匹配原因或信号（方便人工复核）。

## 风险与边界
- 自动匹配准确率依赖 TBox 完整性与字段命名质量。
- JDBC 类型多样化，需按驱动逐步适配。
- Demo 阶段以本地可运行优先，生产级需补充权限与数据治理。

## 里程碑（建议）
1. 需求确认与目录搭建。
2. 前后端框架落地 + TBox 解析。
3. 数据源解析（CSV/XLSX/JDBC）。
4. 智能体匹配与可视化调整。
5. ABox 生成与 Ontop 接入 Demo。

## 验收标准（MVP）
- 能完成 TBox 上传 + 数据源解析。
- 自动生成字段-属性映射结果并可修改。
- 可输出 ABox RDF 或 R2RML 映射。
- 本地 Ontop 可用于简单演示。
